<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Key Support</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <div id="button-list" class="button-list">

    </div>
</body>
</html>

<script>
    function textHandler(urlSearch, urlSearchParams) {
        const buttonList = document.getElementById('button-list')
        //get all match (text|\d) param's count length
        console.log(urlSearch)
        const textsCount = urlSearch.match('(text|\d)').length
        let text = urlSearchParams.get('text')
        if(text){
            let buttonNode = document.createElement('button')
            let buttonTextNode = document.createTextNode(text)
            buttonNode.appendChild(buttonTextNode)
            buttonNode.addEventListener('click', () => {
                liff.sendMessages([
                    {
                        type: 'text',
                        text: text
                    }
                ])
            })
            buttonList.appendChild(buttonNode)
        }
        for (let index = 0; index < textsCount; index++) {
            text = urlSearchParams.get('text' + index)
            if(text){
                let buttonNode = document.createElement('button')
                let buttonTextNode = document.createTextNode(text)
                buttonNode.appendChild(buttonTextNode)
                buttonNode.addEventListener('click', () => {
                    liff.sendMessages([
                        {
                            type: 'text',
                            text: text
                        }
                    ])
                })
                buttonList.appendChild(buttonNode)
            }
        }
    }

    function closeHandler(urlSearch, urlSearchParams) {
        const close = urlSearchParams.get('close') //yes
        if(close === 'yes'){
            liff.closeWindow()
        }
    }
    liff
        .init({
            liffId: "1655758300-4G7poLbg"
        })
        .then(() => {
            const urlSearch = window.location.search
            const urlSearchParams = new URLSearchParams(urlSearch)
            //text
            textHandler(urlSearch, urlSearchParams)
            //auto close window
            closeHandler(urlSearch, urlSearchParams)
        })
</script>